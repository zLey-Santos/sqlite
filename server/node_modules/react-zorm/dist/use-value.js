"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Value = exports.useValue = void 0;
const react_1 = require("react");
const utils_1 = require("./utils");
function useValue(opts) {
    const [value, setValue] = (0, react_1.useState)(opts.initialValue ?? "");
    const mapRef = (0, react_1.useRef)(opts.transform);
    (0, react_1.useEffect)(() => {
        const form = opts.zorm.refObject.current;
        if (!form) {
            return;
        }
        const listener = (e) => {
            const input = e.target;
            if (!(0, utils_1.isValuedElement)(input)) {
                return;
            }
            if (opts.name !== input.name) {
                return;
            }
            if (mapRef.current) {
                setValue(mapRef.current(input.value));
            }
            else {
                setValue(input.value ?? "");
            }
        };
        const initialInput = form.querySelector(`[name="${opts.name}"]`);
        if (initialInput) {
            listener({ target: initialInput });
        }
        const event = opts.event ?? "input";
        form.addEventListener(event, listener);
        return () => {
            form.removeEventListener(event, listener);
        };
    }, [opts.name, opts.zorm.refObject, opts.event]);
    return value;
}
exports.useValue = useValue;
function Value(props) {
    const value = useValue(props);
    return props.children(value);
}
exports.Value = Value;
//# sourceMappingURL=use-value.js.map